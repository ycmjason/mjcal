var xe=Object.defineProperty,fe=Object.defineProperties;var me=Object.getOwnPropertyDescriptors;var w=Object.getOwnPropertySymbols;var U=Object.prototype.hasOwnProperty,X=Object.prototype.propertyIsEnumerable;var Y=(e,n,s)=>n in e?xe(e,n,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[n]=s,p=(e,n)=>{for(var s in n||(n={}))U.call(n,s)&&Y(e,s,n[s]);if(w)for(var s of w(n))X.call(n,s)&&Y(e,s,n[s]);return e},C=(e,n)=>fe(e,me(n));var K=(e,n)=>{var s={};for(var o in e)U.call(e,o)&&n.indexOf(o)<0&&(s[o]=e[o]);if(e!=null&&w)for(var o of w(e))n.indexOf(o)<0&&X.call(e,o)&&(s[o]=e[o]);return s};import{n as Z,r as i,j as t,f as E,u as ee,P as ge,a as c,S as k,B as R,I as A,b as m,l as Ce,t as te,C as S,c as y,s as Se,d as ye,F as be,e as ve,g as T,h as Ie,i as Pe,O as we,k as Te,M as Me,m as v,T as I,o as x,p as W,q as ke,v as ne,w as re,x as se,y as We,D as _e,z as Be,A as Fe,E as Le,G as M,H as O,J as oe,K as le,L as ae,N as b,Q as f,R as Ne,U as Re,V as Ee,W as Ae,X as Oe,Y as De,Z as Ve,_ as Ge,$ as He,a0 as $e,a1 as ze,a2 as je,a3 as Je,a4 as qe,a5 as Ye}from"./vendor.8495ce84.js";const Ue=function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))o(r);new MutationObserver(r=>{for(const l of r)if(l.type==="childList")for(const a of l.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&o(a)}).observe(document,{childList:!0,subtree:!0});function s(r){const l={};return r.integrity&&(l.integrity=r.integrity),r.referrerpolicy&&(l.referrerPolicy=r.referrerpolicy),r.crossorigin==="use-credentials"?l.credentials="include":r.crossorigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function o(r){if(r.ep)return;r.ep=!0;const l=s(r);fetch(r.href,l)}};Ue();const ie=e=>p({id:Z()},e),Xe=s=>{var o=s,{playerIds:e}=o,n=K(o,["playerIds"]);if(e.length!==4)throw new Error("playerIds.length is not 4");return ie(p({isTied:!1,playerIds:e},n))},_=i.exports.createContext({rounds:[],addRound:()=>{},removeRound:()=>{}}),Ke=({children:e})=>{const[n,s]=i.exports.useState([]);return t(_.Provider,{value:{rounds:n,addRound:o=>s(E(n,r=>{r.push(ie(o))})),removeRound:o=>s(n.filter(r=>r.id!==o))},children:e})},Qe=({farn:e,halfSpicyFrom:n})=>Number((2**Math.min(e,n)*1.5**Math.max(0,Math.ceil((e-n)/2))*(4/3)**Math.max(0,Math.floor((e-n)/2))).toFixed(2)),Ze=({farn:e,halfSpicyFrom:n,baseScore:s,isSelfTouch:o})=>Qe({farn:e,halfSpicyFrom:n})*s*(o?6:4),et=({score:e,chungJai:n,isLoser:s,loserCount:o,isSelfTouch:r})=>{if(r)return s?-1*e/o:0;switch(n){case"full":return s?-1*e:0;case"half":return-1*e/(s?2:4)}},ce=(e,{players:n,scoringSettings:s})=>{if(e.isTied)return n.map(()=>0);const o=Ze({farn:e.farn,baseScore:{"25chicken":.25,"51":.5,"12mosquitoes":1}[s.chipValue],halfSpicyFrom:s.halfSpicyFrom==="never"?Number.POSITIVE_INFINITY:s.halfSpicyFrom,isSelfTouch:e.isSelfTouch}),r=new Set(e.playerIds);return n.map(({id:l})=>r.has(l)?e.winnerId===l?o:et({score:o,chungJai:s.chungJai,isLoser:e.loserIds.includes(l),loserCount:e.loserIds.length,isSelfTouch:e.isSelfTouch}):null)},de=e=>p({id:Z()},e),P=i.exports.createContext({players:[],setPlayers:()=>{}}),tt=({children:e})=>{const[n,s]=i.exports.useState(Array.from({length:4},(o,r)=>de({name:`Player ${r+1}`})));return t(P.Provider,{value:{players:n,setPlayers:s},children:e})},ue={chungJai:"full",chipValue:"25chicken",halfSpicyFrom:4},B=i.exports.createContext({settings:ue,setSettings:()=>{}}),nt=({children:e})=>{const[n,s]=i.exports.useState(ue);return t(B.Provider,{value:{settings:n,setSettings:s},children:e})},rt=({data:e})=>{var s,o,r,l;const n=ee();return t(ge,{data:e.map(({playerName:a,scores:d})=>({id:a,data:d.map((u,h)=>({x:h,y:u}))})),pointLabelYOffset:-12,enableSlices:"x",theme:{background:n.palette.background.default,textColor:n.palette.text.secondary,fontSize:11,grid:{line:{stroke:n.palette.secondary.dark,strokeWidth:1}},tooltip:{container:{background:n.palette.secondary.light,color:n.palette.secondary.contrastText,fontSize:12}}},margin:{top:50,right:20,bottom:85,left:60},yScale:{type:"linear",min:-Math.max(...e.flatMap(({scores:a})=>a).map(a=>Math.abs(a!=null?a:0))),max:Math.max(...e.flatMap(({scores:a})=>a).map(a=>Math.abs(a!=null?a:0)))},colors:{scheme:"set3"},gridXValues:(o=(s=e.at(0))==null?void 0:s.scores.length)!=null?o:0,axisBottom:{legend:"round",legendOffset:36,legendPosition:"middle",tickValues:(l=(r=e.at(0))==null?void 0:r.scores.length)!=null?l:0},axisLeft:{legend:"score",legendOffset:-40,legendPosition:"middle"},useMesh:!0,legends:[{anchor:"bottom-left",direction:"row",justify:!1,translateX:-20,translateY:70,itemsSpacing:0,itemDirection:"left-to-right",itemWidth:80,itemHeight:20,itemOpacity:.75,symbolSize:12,symbolShape:"circle",symbolBorderColor:"rgba(0, 0, 0, .5)"}]})},st=25,ot=e=>{const[n,s]=i.exports.useState(null);return i.exports.useEffect(()=>{if(!e.current)return;const o=e.current;s({left:o.scrollLeft,top:o.scrollTop})},[]),i.exports.useEffect(()=>{if(!e.current)return;const o=e.current,r=Ce(()=>s({left:o.scrollLeft,top:o.scrollTop}),100);return o.addEventListener("scroll",r),()=>o.removeEventListener("scroll",r)},[e]),n},Q=500,lt=({data:e})=>{var o,r;const n=i.exports.useRef(null),s=ot(n);return c(k,{children:[t(R,{sx:{overflowX:"auto",overflowY:"hidden"},ref:n,children:t(R,{sx:{minWidth:`${st*((r=(o=e.at(0))==null?void 0:o.scores.length)!=null?r:1)}px`,height:"700px",maxHeight:"calc(80vh - 200px)",display:"flex",alignItem:"center"},children:t(rt,{data:e})})}),c(R,{sx:{display:"flex",justifyContent:"flex-end"},children:[t(A,{onClick:()=>{var l;return(l=n.current)==null?void 0:l.scrollBy({left:-Q,behavior:"smooth"})},disabled:!s||s.left<=0,children:t(m,{children:"chevron_left"})}),t(A,{onClick:()=>{var l;return(l=n.current)==null?void 0:l.scrollBy({left:Q,behavior:"smooth"})},disabled:!s||!n.current||s.left>=n.current.scrollWidth-n.current.clientWidth,children:t(m,{children:"chevron_right"})})]})]})},at=()=>{const{players:e}=i.exports.useContext(P),{settings:n}=i.exports.useContext(B),{rounds:s}=i.exports.useContext(_),o=te(s.map(r=>ce(r,{players:e,scoringSettings:n})));return t(S,{maxWidth:"xl",children:s.length<=0?t(y,{sx:{width:"100%",height:"70vh",backgroundColor:r=>r.palette.grey[900],color:r=>r.palette.getContrastText(r.palette.grey[900]),display:"flex",justifyContent:"center",alignItems:"center"},children:"Add a round to see chart"}):t(lt,{data:o.map(r=>Se((l,a)=>l+(a!=null?a:0),0,r)).map((r,l)=>({playerName:e[l].name,scores:r}))})})},it=e=>{const n=ee(),s=ye(n.breakpoints.down("xl")).valueOf();return t(be,C(p(p({color:"primary"},s?{variant:"circular",sx:{position:"fixed",bottom:n.spacing(10),right:n.spacing(3),zIndex:1}}:{variant:"extended",sx:{gap:1,"&::after":{content:'"Add Guk"'}}}),e),{children:t(ve,{openIcon:t(m,{children:"add"})})}))},ct=({allPlayers:e,selectedPlayerIds:n,onSelectedPlayerIdsChange:s})=>{const o=i.exports.useMemo(()=>new Set(n),[n]),r=i.exports.useMemo(()=>new Map(e.map(l=>[l.id,l])),[e]);return c(T,{fullWidth:!0,sx:{mt:1},children:[t(Ie,{children:"Players"}),t(Pe,{multiple:!0,value:n,onChange:l=>{const a=typeof l.target.value=="string"?l.target.value.split(","):l.target.value;a.length>4||s(a)},input:t(we,{label:"Players"}),renderValue:l=>t(y,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:l.map(a=>{var d;return t(Te,{label:((d=r.get(a))==null?void 0:d.name)||"error: cannot find player"},a)})}),children:e.map(({id:l,name:a})=>t(Me,{value:l,sx:({typography:d})=>({fontWeight:o.has(l)?d.fontWeightMedium:d.fontWeightRegular}),children:a},l))})]})},dt=()=>{const{players:e,selectedPlayerIds:n,setSelectedPlayerIds:s,setCanNext:o}=i.exports.useContext(F);return i.exports.useEffect(()=>o(n.length===4),[n]),t(ct,{allPlayers:e,selectedPlayerIds:n,onSelectedPlayerIdsChange:s})},ut=({players:e,loserIds:n,onLoserIdsChange:s,disabled:o})=>c(k,{children:[t(v,{children:"Loser(s)"}),t(I,{color:"primary",value:n,onChange:(r,l)=>s([l]),exclusive:!0,fullWidth:!0,disabled:o,children:e.map(({id:r,name:l})=>t(x,{value:r,children:l},r))})]}),ht=()=>{const{selectedPlayers:e,winnerId:n,loserIds:s,setLoserIds:o,isSelfTouch:r,isBao:l,setIsBao:a,setCanNext:d}=i.exports.useContext(F),u=i.exports.useMemo(()=>e.filter(({id:h})=>h!==n),[e,n]);return i.exports.useEffect(()=>a(r&&l),[r,l]),i.exports.useEffect(()=>o(r&&!l?u.map(({id:h})=>h):[]),[r,l]),i.exports.useEffect(()=>d(s.length>0),[s]),c(W,{children:[r&&t(ke,{children:t(ne,{control:t(re,{checked:l,onChange:(h,L)=>a(L)}),label:"Is bao?"})}),t(ut,{loserIds:s,disabled:r&&!l,onLoserIdsChange:o,players:u})]})},pt=({farn:e,onFarnChange:n})=>c(k,{direction:"row",spacing:2,alignItems:"center",flexWrap:"wrap",children:[t(se,{value:e,label:"farn",inputProps:{readOnly:!0},size:"small",sx:({spacing:s})=>({width:s(8)})}),t(y,{sx:{pr:1},flexGrow:1,children:t(We,{value:e,onChange:(s,o)=>n(o),step:1,max:15,marks:[3,7,13].map(s=>({value:s,label:`${s} farn`}))})})]}),xt=({players:e,winnerId:n,onWinnerIdChange:s})=>c(k,{children:[t(v,{children:"Winner"}),t(I,{color:"primary",value:n,exclusive:!0,onChange:(o,r)=>{!e.map(({id:l})=>l).includes(r)||s(r)},fullWidth:!0,children:e.map(({id:o,name:r})=>t(x,{value:o,children:r},o))})]}),ft=()=>{const{selectedPlayers:e,winnerId:n,setWinnerId:s,farn:o,setFarn:r,isSelfTouch:l,setIsSelfTouch:a,setCanNext:d}=i.exports.useContext(F);return i.exports.useEffect(()=>d(!!n),[n]),c(W,{children:[t(xt,{players:e,winnerId:n,onWinnerIdChange:s}),t(pt,{farn:o,onFarnChange:r}),t(ne,{control:t(re,{checked:l,onChange:(u,h)=>a(h)}),label:"Is self-touch? \u{1F90F}"})]})},mt=3,F=i.exports.createContext({players:[],selectedPlayers:[],selectedPlayerIds:[],setSelectedPlayerIds:e=>{},farn:3,setFarn:e=>{},winnerId:void 0,setWinnerId:e=>{},loserIds:[],setLoserIds:e=>{},isBao:!1,setIsBao:e=>{},isSelfTouch:!1,setIsSelfTouch:e=>{},setCanNext:e=>{}}),gt=({players:e,onAddRound:n})=>{const s=i.exports.useMemo(()=>new Map(e.map(g=>[g.id,g])),[e]),[o,r]=i.exports.useState(!1),[l,a]=i.exports.useState(0),[d,u]=i.exports.useState(!1),[h,L]=i.exports.useState(e.slice(0,4).map(({id:g})=>g)),[D,V]=i.exports.useState(3),[N,G]=i.exports.useState(),[H,$]=i.exports.useState([]),[z,j]=i.exports.useState(!1),[J,q]=i.exports.useState(!1);i.exports.useEffect(()=>{!o||(a(0),V(3),G(void 0),$([]),j(!1),q(!1),u(!1))},[o]);const he=i.exports.useMemo(()=>h.map(g=>s.get(g)),[h,s]);return c(W,{children:[t(it,{onClick:()=>r(!0)}),c(_e,{open:o,onClose:()=>r(!1),fullWidth:!0,children:[t(Be,{children:"Add Guk"}),t(Fe,{children:t(F.Provider,{value:{players:e,selectedPlayers:he,selectedPlayerIds:h,setSelectedPlayerIds:L,farn:D,setFarn:V,winnerId:N,setWinnerId:G,loserIds:H,setLoserIds:$,isBao:z,setIsBao:j,isSelfTouch:J,setIsSelfTouch:q,setCanNext:u},children:[()=>t(dt,{}),()=>t(ft,{}),()=>t(ht,{})][l]()})}),c(Le,{children:[t(M,{onClick:()=>r(!1),sx:{mr:"auto"},color:"secondary",children:"Cancel"}),t(M,{disabled:l<=0,onClick:()=>a(l-1),children:"Back"}),(({onClick:g,text:pe})=>t(M,{onClick:g,disabled:!d,children:pe}))(l<mt-1?{text:"Next",onClick:()=>a(l+1)}:{text:"Done",onClick:()=>{if(r(!1),!N)throw new Error("no winnerId found");n(Xe({playerIds:h,winnerId:N,loserIds:H,farn:D,isBao:z,isSelfTouch:J}))}})]})]})]})},Ct=()=>{const{players:e}=i.exports.useContext(P),{addRound:n}=i.exports.useContext(_);return t(gt,{players:e,onAddRound:n})},St=({players:e,onSetPlayers:n,sx:s})=>c(O,{sx:p({flexGrow:1,display:"flex",gap:1,flexDirection:"column",padding:2},s),children:[t(y,{sx:{marginBottom:1},children:t(M,{variant:"outlined",startIcon:t(m,{children:"person_add"}),onClick:()=>n(E(e,o=>{o.push(de({name:`Player ${e.length+1}`}))})),children:"Add Player"})}),t(oe,{children:t(le,{sx:{minWidth:320},children:t(ae,{children:e.map((o,r)=>c(b,{children:[t(f,{padding:"checkbox",children:t(A,{onClick:()=>n(e.filter(({id:l})=>l!==o.id)),disabled:e.length<=4,children:t(m,{children:"delete"})})}),t(f,{children:t(se,{label:`Player ${r+1}`,variant:"outlined",InputProps:{startAdornment:t(Ne,{position:"start",children:t(m,{sx:{marginRight:1},children:"person"})})},value:o.name,onChange:l=>n(E(e,a=>{const d=a.find(({id:u})=>u===o.id);!d||(d.name=l.target.value)})),fullWidth:!0})})]},o.id))})})})]}),yt=({settings:e,onSetSettings:n,sx:s})=>c(O,{sx:p({flexGrow:1,display:"flex",gap:2,flexDirection:"column",padding:2},s),children:[c(T,{children:[t(v,{sx:{mb:1},children:"Chung Jai"}),c(I,{value:e.chungJai,exclusive:!0,onChange:(o,r)=>r&&n(C(p({},e),{chungJai:r})),fullWidth:!0,children:[t(x,{value:"half",children:"Half"}),t(x,{value:"full",children:"Full"})]})]}),c(T,{children:[t(v,{sx:{mb:1},children:"Chips Value"}),c(I,{value:e.chipValue,exclusive:!0,onChange:(o,r)=>r&&n(C(p({},e),{chipValue:r})),fullWidth:!0,children:[t(x,{value:"25chicken",children:"25chicken"}),t(x,{value:"51",children:"51"}),t(x,{value:"12mosquitoes",children:"12mosquitoes"})]})]}),c(T,{children:[t(v,{sx:{mb:1},children:"Half Spicy From"}),c(I,{value:e.halfSpicyFrom,exclusive:!0,onChange:(o,r)=>r&&n(C(p({},e),{halfSpicyFrom:r})),fullWidth:!0,sx:{mb:1},children:[t(x,{value:"never",children:"Never"}),t(x,{value:4,children:"4"})]}),t(Re,{inputProps:{inputMode:"numeric",pattern:"[0-9]{2}"},value:["never",4].includes(e.halfSpicyFrom)?"":e.halfSpicyFrom,onChange:o=>n(C(p({},e),{halfSpicyFrom:Number.parseInt(o.target.value)||4})),placeholder:"custom value",sx:{alignSelf:"flex-start",pt:1,pl:1,pr:1}})]})]}),bt=()=>{const{players:e,setPlayers:n}=i.exports.useContext(P),{settings:s,setSettings:o}=i.exports.useContext(B);return c(S,{maxWidth:"xl",sx:{display:"flex",flexDirection:"column",gap:3},children:[t(St,{players:e,onSetPlayers:r=>n(r)}),t(yt,{settings:s,onSetSettings:o})]})},vt=()=>{const{players:e}=i.exports.useContext(P),{rounds:n}=i.exports.useContext(_),{settings:s}=i.exports.useContext(B),o=i.exports.useMemo(()=>n.map(r=>ce(r,{players:e,scoringSettings:s})),[n,e,s]);return t(S,{maxWidth:"xl",children:t(O,{sx:{width:"100%",overflow:"hidden"},children:t(oe,{sx:{maxHeight:"65vh"},children:c(le,{stickyHeader:!0,"aria-label":"sticky table",children:[t(Ee,{children:c(b,{sx:{whiteSpace:"nowrap"},children:[t(f,{children:"#"}),e.map(r=>t(f,{children:r.name},r.id))]})}),t(ae,{children:n.length<=0?t(b,{children:t(f,{colSpan:1+e.length,align:"center",children:"No data to show yet..."})}):c(W,{children:[o.map((r,l)=>c(b,{children:[c(f,{children:["#",l+1]}),r.map((a,d)=>t(f,{sx:a?{color:({palette:u})=>u[a>0?"success":"error"].main}:{},children:a!=null?a:"-"},d))]},`round${l}`)),c(b,{sx:({palette:r})=>({bgcolor:"#122b36",color:r.info.contrastText}),ref:r=>r==null?void 0:r.scrollIntoView(),children:[t(f,{children:"Sum"}),te(o).map(r=>Ae(r.map(l=>l!=null?l:0))).map((r,l)=>t(f,{sx:r?{color:({palette:a})=>a[r>0?"success":"error"].main}:{},children:r},l))]})]})})]})})})})},It=({PreView:e,views:n})=>{var l;const[s,o]=i.exports.useState(0),r=(l=n[s])==null?void 0:l.View;return c(y,{sx:{pb:12},children:[t(e,{viewId:n[s].id}),t(r,{}),t(S,{maxWidth:"xl",sx:{position:"fixed",bottom:0,left:0,right:0,zIndex:1},children:t(Oe,{showLabels:!0,value:s,onChange:(a,d)=>o(d),sx:{width:"100%"},children:n.map(({label:a,icon:d},u)=>t(De,{label:a,icon:d},u))})})]})},Pt=()=>t(y,{sx:{flexGrow:1,marginBottom:2},children:t(Ve,{position:"static",children:t(Ge,{children:t(S,{maxWidth:"xl",children:t(He,{variant:"h6",component:"h1",sx:{flexGrow:1},children:"MJCal"})})})})}),wt=({children:e})=>c($e,{theme:ze({palette:{mode:"dark",secondary:{main:"#b7b7b7",dark:"#5e5e5e",contrastText:"#000"}}}),children:[t(je,{}),t(tt,{children:t(Ke,{children:t(nt,{children:e})})})]}),Tt=()=>c(wt,{children:[t(Pt,{}),t(It,{PreView:({viewId:e})=>t(S,{maxWidth:"xl",sx:{mb:2,display:e==="settings"?"none":void 0},children:t(Ct,{})}),views:[{id:"chart",label:"Chart",icon:t(m,{children:"stacked_line_chart"}),View:at},{id:"table",label:"Table",icon:t(m,{children:"list_alt"}),View:vt},{id:"settings",label:"Settings",icon:t(m,{children:"settings"}),View:bt}]})]});Je();qe.render(t(Ye.StrictMode,{children:t(Tt,{})}),document.getElementById("root"));
